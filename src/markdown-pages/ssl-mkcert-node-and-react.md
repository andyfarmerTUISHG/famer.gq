---
slug: "/blog/ssl-mkcert-node-and-react"
title: "HTTPS locally with Node & create-react-app"
date: "2020-08-29"
---

Today launching a website, PWAs, application or API not over HTTPS is unheard of. However, ever tutorial creates of demos will show these running on `http://lofalhsot:3000` - but it is possible to run your app over HTTPS during development. This is how I do it, and you can too.

We will use [mkcert](https://github.com/FiloSottile/mkcert) as it doesn't generate self-signed certificates, but certificates signed by your own private certification authority (CA) , which your machine is automatically configured to trust. So when your browser loads a certificate generated by your instance of mkcert, it will show up with a green lock!

## Step 1 - Install mkcert

[mkcert](https://github.com/FiloSottile/mkcert) is a simple tool for making locally-trusted development certificates and requires no configuration.

As use macOS, use [Homebrew](https://brew.sh/)

```bash
# Install mkcert tool
brew install mkcert

# Setup mkcert on your machine (creates a CA)
mkcert -install
```

## Step 2 - Create Certificate

As I use mkcert for mutliple certificates, I like a SSL Certificate for each project I like to create a folder to store these - currently I keep this within the root of my Sites folder

```bash
mkdir -p ~/Sites/mkcert
cd ~/Sites/mkcert
```

To generate a certificale in our newly created folder, I like to user the following style of command.

```bash
mkcert -key-file ~/Sites/mkcert/localhost-key.pem -cert-file ~/Sites/mkcert/localhost-cert.pem "localhost"
```

So, a breakdown of what the command does

- `-key-file` specifies the location - and I like to name the key file associated with the project of the apache config
- `-cert-file` specifies the location - and I like to name the key file associated with the project of the apache config
- `"localhost"` is the name for which to create the valid certificates

## Step 3 - Use New Certificate - Node Project

Example of Node project with mkcert

```bash
mkdir mkcert-node
cd mkcert-node/
npm init -y
touch server.js
```

Edit server.js

```javascript
const https = require("https")
const fs = require("fs")
const hostname = "localhost"
const port = 3001

const server = https.createServer(
  {
    key: fs.readFileSync("/Users/{yourprofile}/Sites/mkcert/localhost-key.pem"),
    cert: fs.readFileSync(
      "/Users/{yourprofile}/Sites/mkcert/localhost-cert.pem"
    ),
  },
  (req, res) => {
    res.statusCode = 200
    res.setHeader("Content-Type", "text/plain")
    res.end("Hello World\n")
  }
)

server.listen(port, hostname, () => {
  console.log(`Server running at https://${hostname}:${port}/`)
})
```

Things to note -

- We are requiring `https` rather than the typical `http`
- We are using `https.createServer` instead of `http.createServer`
- We are passing the key and certificate via the files system module and requires the fully qualified path to the files, ie dont use `~` use `/Users/{yourprofile}`

Start the server with `node server.js`

## Step 4 - Use New Certificate - React Project

Examples of creating a new React with mkcert

```bash
npx create-react-app mkcert-react
cd mkcert-react
npm start
```

Edit `package.json` and change the start to script to :-

```javascript
"scripts": {
    "start": "HTTPS=true react-scripts start",
    "build": "react-scripts build",
    "test": "react-scripts test",
    "eject": "react-scripts eject"
}
```

This will give start the development server in a Secure mode. This will however cause issues within the browser complaining that the certificate is invalid. A bit more editing and we should be good to go.

```javascript
  "scripts": {
    "start": "HTTPS=true SSL_CRT_FILE=~/Sites/mkcert/localhost-cert.pem SSL_KEY_FILE=~/Sites/mkcert/localhost-key.pem react-scripts start",
    "build": "react-scripts build",
    "test": "react-scripts test",
    "eject": "react-scripts eject"
  },
```

The generated files can also be used for your local Apache configuration in the virtual host like this:-

```conf
<VirtualHost localhost:443>
  ...
  SSLEngine on
  SSLCertificateFile "/Users/{yourprofile}/Sites/mkcert/localhost-cert.pem"
  SSLCertificateKeyFile "/Users/{yourprofile}/Sites/mkcert/localhost-key.pem"
  </VirtualHost>
```
